"use strict";function RainyDay(t,i,e,s,r,a){this.canvasid=t,this.canvas=document.getElementById(t),this.sourceid=i,this.img=document.getElementById(i),this.prepareBackground(a||8,e,s),this.w=this.canvas.width,this.h=this.canvas.height,this.prepareGlass(r||1),this.reflection=this.REFLECTION_MINIATURE,this.trail=this.TRAIL_DROPS,this.gravity=this.GRAVITY_NON_LINEAR,this.VARIABLE_GRAVITY_THRESHOLD=3,this.VARIABLE_GRAVITY_ANGLE=Math.PI/2,this.VARIABLE_FPS=25,this.VARIABLE_FILL_STYLE="#8ED6FF",this.VARIABLE_COLLISIONS=!1,this.collision=this.COLLISION_SIMPLE}function Drop(t,i,e,s,r){this.x=Math.floor(i),this.y=Math.floor(e),this.r1=Math.random()*r+s,this.rainyday=t;this.r2=.8*this.r1,this.linepoints=t.getLinepoints(4),this.context=t.context,this.reflection=t.reflected}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function CollisionMatrix(t,i,e){this.resolution=e,this.xc=t,this.yc=i,this.matrix=new Array(t);for(var s=0;s<=t+5;s++){this.matrix[s]=Array(i);for(var r=0;r<=i+5;++r)this.matrix[s][r]=new DropItem(null)}}function DropItem(t){this.drop=t,this.next=null}RainyDay.prototype.prepareReflections=function(){this.reflected=document.createElement("canvas"),this.reflected.width=this.canvas.width,this.reflected.height=this.canvas.height;var t=this.reflected.getContext("2d");t.translate(this.reflected.width/2,this.reflected.height/2),t.rotate(Math.PI),t.drawImage(this.img,-this.reflected.width/2,-this.reflected.height/2,this.reflected.width,this.reflected.height)},RainyDay.prototype.prepareGlass=function(t){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.glass.style.position="absolute",this.glass.style.top=this.canvas.offsetTop,this.glass.style.left=this.canvas.offsetLeft,this.glass.style.zIndex=this.canvas.style.zIndex+100,this.canvas.parentNode.appendChild(this.glass),this.context=this.glass.getContext("2d"),this.glass.style.opacity=t},RainyDay.prototype.preset=function(t,i,e){return{min:t,base:i,quan:e}},RainyDay.prototype.rain=function(t,i){if(this.reflection!=this.REFLECTION_NONE&&this.prepareReflections(),i>0){if(this.presets=t,this.PRIVATE_GRAVITY_FORCE_FACTOR_Y=.005*this.VARIABLE_FPS/25,this.PRIVATE_GRAVITY_FORCE_FACTOR_X=(Math.PI/2-this.VARIABLE_GRAVITY_ANGLE)*(.005*this.VARIABLE_FPS)/50,this.VARIABLE_COLLISIONS){for(var e=0,s=0;s<t.length;s++)t[s].base+t[s].min>e&&(e=Math.floor(t[s].base+t[s].min));if(e>0){var r=Math.ceil(this.w/e),a=Math.ceil(this.h/e);this.matrix=new CollisionMatrix(r,a,e)}else this.VARIABLE_COLLISIONS=!1}setInterval(function(i){return function(){for(var e,s=Math.random(),r=0;r<t.length;r++)if(s<t[r].quan){e=t[r];break}e&&i.putDrop(new Drop(i,Math.random()*i.w,Math.random()*i.h,e.min,e.base))}}(this),i)}else for(var s=0;s<t.length;s++)for(var n=t[s],h=0;h<n.quan;++h)this.putDrop(new Drop(this,Math.random()*this.w,Math.random()*this.h,n.min,n.base))},RainyDay.prototype.putDrop=function(t){t.draw(),this.gravity&&t.r1>this.VARIABLE_GRAVITY_THRESHOLD&&(this.VARIABLE_COLLISIONS&&this.matrix.update(t),t.animate())},RainyDay.prototype.getLinepoints=function(t){var i={};i.first={x:0,y:1};var e,s,r,a,n,h={x:1,y:1},o=1,l=1;i.first.next=h;for(var y=0;y<t;y++)for(e=i.first;null!=e.next;){s=e.next,r=s.x-e.x,a=.5*(e.x+s.x),n=.5*(e.y+s.y),n+=r*(2*Math.random()-1);var p={x:a,y:n};n<o?o=n:n>l&&(l=n),p.next=s,e.next=p,e=s}if(l!=o){var c=1/(l-o);for(e=i.first;null!=e;)e.y=c*(e.y-o),e=e.next}else for(e=i.first;null!=e;)e.y=1,e=e.next;return i},Drop.prototype.draw=function(){var t,i,e,s,r;for(this.context.save(),this.context.beginPath(),t=this.linepoints.first,e=0,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),r=this.y+i*Math.sin(e),this.context.lineTo(s,r);null!=t.next;)t=t.next,e=2*Math.PI*t.x+0,i=this.r2+.5*Math.random()*(this.r2-this.r1),s=this.x+i*Math.cos(e),r=this.y+i*Math.sin(e),this.context.lineTo(s,r);this.context.clip(),this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},Drop.prototype.clear=function(t){return this.context.clearRect(this.x-this.r1-1,this.y-this.r1-1,2*this.r1+2,2*this.r1+2),t?(clearInterval(this.intid),!0):this.y-this.r1>this.rainyday.h?(clearInterval(this.intid),!0):(this.x-this.r1>this.rainyday.w||this.x+this.r1<0)&&(clearInterval(this.intid),!0)},Drop.prototype.animate=function(){this.intid=setInterval(function(t){return function(){var i=t.rainyday.gravity(t);if(!i&&t.rainyday.trail&&t.rainyday.trail(t),t.rainyday.VARIABLE_COLLISIONS){var e=t.rainyday.matrix.update(t,i);e&&t.rainyday.collision(t,e.drop)}}}(this),Math.floor(1e3/this.rainyday.VARIABLE_FPS))},RainyDay.prototype.TRAIL_NONE=function(t){},RainyDay.prototype.TRAIL_DROPS=function(t){(!t.trail_y||t.y-t.trail_y>=10*Math.random()*t.r1)&&(t.trail_y=t.y,this.putDrop(new Drop(this,t.x,t.y-t.r1-5,0,Math.ceil(t.r1/5))))},RainyDay.prototype.GRAVITY_NONE=function(t){return!0},RainyDay.prototype.GRAVITY_LINEAR=function(t){return!!t.clear()||(t.yspeed?(t.yspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.draw(),!1)},RainyDay.prototype.GRAVITY_NON_LINEAR=function(t){return!!t.clear()||((!t.seed||t.seed<0)&&(t.seed=Math.floor(Math.random()*this.VARIABLE_FPS),t.skipping=0==t.skipping,t.slowing=!0),t.seed--,t.yspeed?t.slowing?(t.yspeed/=1.1,t.xspeed/=1.1,t.yspeed<this.PRIVATE_GRAVITY_FORCE_FACTOR_Y&&(t.slowing=!1)):t.skipping?(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X):(t.yspeed+=10*this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(t.r1),t.xspeed+=10*this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(t.r1)):(t.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,t.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),t.y+=t.yspeed,t.x+=t.xspeed,t.draw(),!1)},RainyDay.prototype.REFLECTION_NONE=function(t){this.context.fillStyle=this.VARIABLE_FILL_STYLE,this.context.fill()},RainyDay.prototype.REFLECTION_MINIATURE=function(t){this.context.drawImage(this.reflected,t.x-t.r1,t.y-t.r1,2*t.r1,2*t.r1)},RainyDay.prototype.COLLISION_SIMPLE=function(t,i){t.clear(),i.clear(!0),t.x=(t.x+i.x)/2,t.y=(t.y+i.y)/2};var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];RainyDay.prototype.prepareBackground=function(t,i,e){i&&e?(this.canvas.style.width=i+"px",this.canvas.style.height=e+"px",this.canvas.width=i,this.canvas.height=e):(i=this.canvas.width,e=this.canvas.height);var s=this.canvas.getContext("2d");s.clearRect(0,0,i,e),s.drawImage(this.img,0,0,i,e),isNaN(t)||t<1||this.stackBlurCanvasRGB(0,0,i,e,t)},RainyDay.prototype.stackBlurCanvasRGB=function(t,i,e,s,r){r|=0;var a,n,h,o,l,y,p,c,d,R,f,x,I,A,u,_,g,m,E,T,v=this.canvas.getContext("2d"),L=v.getImageData(t,i,e,s),O=L.data,V=r+r+1,C=e-1,M=s-1,D=r+1,F=D*(D+1)/2,w=new BlurStack,N=w;for(h=1;h<V;h++)if(N=N.next=new BlurStack,h==D)var S=N;N.next=w;var Y=null,B=null;p=y=0;var G=mul_table[r],P=shg_table[r];for(n=0;n<s;n++){for(A=u=_=c=d=R=0,f=D*(g=O[y]),x=D*(m=O[y+1]),I=D*(E=O[y+2]),c+=F*g,d+=F*m,R+=F*E,N=w,h=0;h<D;h++)N.r=g,N.g=m,N.b=E,N=N.next;for(h=1;h<D;h++)o=y+((C<h?C:h)<<2),c+=(N.r=g=O[o])*(T=D-h),d+=(N.g=m=O[o+1])*T,R+=(N.b=E=O[o+2])*T,A+=g,u+=m,_+=E,N=N.next;for(Y=w,B=S,a=0;a<e;a++)O[y]=c*G>>P,O[y+1]=d*G>>P,O[y+2]=R*G>>P,c-=f,d-=x,R-=I,f-=Y.r,x-=Y.g,I-=Y.b,o=p+((o=a+r+1)<C?o:C)<<2,A+=Y.r=O[o],u+=Y.g=O[o+1],_+=Y.b=O[o+2],c+=A,d+=u,R+=_,Y=Y.next,f+=g=B.r,x+=m=B.g,I+=E=B.b,A-=g,u-=m,_-=E,B=B.next,y+=4;p+=e}for(a=0;a<e;a++){for(u=_=A=d=R=c=0,y=a<<2,f=D*(g=O[y]),x=D*(m=O[y+1]),I=D*(E=O[y+2]),c+=F*g,d+=F*m,R+=F*E,N=w,h=0;h<D;h++)N.r=g,N.g=m,N.b=E,N=N.next;for(l=e,h=1;h<=r;h++)y=l+a<<2,c+=(N.r=g=O[y])*(T=D-h),d+=(N.g=m=O[y+1])*T,R+=(N.b=E=O[y+2])*T,A+=g,u+=m,_+=E,N=N.next,h<M&&(l+=e);for(y=a,Y=w,B=S,n=0;n<s;n++)o=y<<2,O[o]=c*G>>P,O[o+1]=d*G>>P,O[o+2]=R*G>>P,c-=f,d-=x,R-=I,f-=Y.r,x-=Y.g,I-=Y.b,o=a+((o=n+D)<M?o:M)*e<<2,c+=A+=Y.r=O[o],d+=u+=Y.g=O[o+1],R+=_+=Y.b=O[o+2],Y=Y.next,f+=g=B.r,x+=m=B.g,I+=E=B.b,A-=g,u-=m,_-=E,B=B.next,y+=e}v.putImageData(L,t,i)},CollisionMatrix.prototype.update=function(t,i){if(t.gid){if(this.matrix[t.gmx][t.gmy].remove(t),i)return null;t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),this.matrix[t.gmx][t.gmy].add(t);var e=this.collisions(t);if(e&&null!=e.next)return e.next}else t.gid=Math.random().toString(36).substr(2,9),t.gmx=Math.floor(t.x/this.resolution),t.gmy=Math.floor(t.y/this.resolution),this.matrix[t.gmx][t.gmy].add(t);return null},CollisionMatrix.prototype.collisions=function(t){var i=new DropItem(null),e=i;return i=this.addAll(i,t.gmx-1,t.gmy),i=this.addAll(i,t.gmx-1,t.gmy+1),i=this.addAll(i,t.gmx,t.gmy+1),i=this.addAll(i,t.gmx+1,t.gmy+1),i=this.addAll(i,t.gmx+1,t.gmy),e},CollisionMatrix.prototype.addAll=function(t,i,e){if(i>0&&e>0&&i<this.xc&&e<this.yc)for(var s=this.matrix[i][e];null!=s.next;)s=s.next,t.next=new DropItem(s.drop),t=t.next;return t},DropItem.prototype.add=function(t){for(var i=this;null!=i.next;)i=i.next;i.next=new DropItem(t)},DropItem.prototype.remove=function(t){for(var i=this,e=null;null!=i.next;)e=i,i=i.next,i.drop.gid==t.gid&&(e.next=i.next)};